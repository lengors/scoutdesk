# yaml-language-server: $schema=https://json.schemastore.org/liquibase-3.2.json
---
databaseChangeLog:
  - changeSet:
      id: add-scraper-specification-mappings
      author: lengors
      changes:
        # Setup scraper owned specifications table
        - createTable:
            tableName: scraper_owned_specifications
            columns:
              - column:
                  name: owner
                  type: varchar
                  constraints:
                    nullable: false
                    primaryKey: true
                    primaryKeyName: pk_scraper_owned_specifications
              - column:
                  name: name
                  type: varchar
                  constraints:
                    nullable: false
                    primaryKey: true
                    primaryKeyName: pk_scraper_owned_specifications
              - column:
                  name: status
                  type: varchar
                  constraints:
                    nullable: false

  - changeSet:
      id: add-scraper-profiles
      author: lengors
      changes:
        # Setup scraper owned profiles table
        - createTable:
            tableName: scraper_owned_profiles
            columns:
              - column:
                  name: owner
                  type: varchar
                  constraints:
                    nullable: false
                    primaryKey: true
                    primaryKeyName: pk_scraper_owned_profiles
              - column:
                  name: name
                  type: varchar
                  constraints:
                    nullable: false
                    primaryKey: true
                    primaryKeyName: pk_scraper_owned_profiles
              - column:
                  name: specification_owner
                  type: varchar
                  constraints:
                    nullable: false
              - column:
                  name: specification_name
                  type: varchar
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: scraper_owned_profiles
            baseColumnNames: specification_owner, specification_name
            constraintName: fk_scraper_owned_profiles_scraper_owned_specifications
            referencedTableName: scraper_owned_specifications
            referencedColumnNames: owner, name

        # Setup scraper inputs table
        - createTable:
            tableName: scraper_inputs
            columns:
              - column:
                  name: profile_owner
                  type: varchar
                  constraints:
                    nullable: false
                    primaryKey: true
                    primaryKeyName: pk_scraper_inputs
              - column:
                  name: profile_name
                  type: varchar
                  constraints:
                    nullable: false
                    primaryKey: true
                    primaryKeyName: pk_scraper_inputs
              - column:
                  name: name
                  type: varchar
                  constraints:
                    nullable: false
                    primaryKey: true
                    primaryKeyName: pk_scraper_inputs
              - column:
                  name: value
                  type: varchar
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: scraper_inputs
            baseColumnNames: profile_owner, profile_name
            constraintName: fk_scraper_inputs_scraper_owned_profiles
            referencedTableName: scraper_owned_profiles
            referencedColumnNames: owner, name

  - changeSet:
      id: add-scraper-strategies
      author: lengors
      changes:
        - createTable:
            tableName: scraper_owned_strategies
            columns:
              - column:
                  name: owner
                  type: varchar
                  constraints:
                    nullable: false
                    primaryKey: true
                    primaryKeyName: pk_scraper_owned_strategies
              - column:
                  name: name
                  type: varchar
                  constraints:
                    nullable: false
                    primaryKey: true
                    primaryKeyName: pk_scraper_owned_strategies

        - createTable:
            tableName: scraper_owned_strategies_scraper_owned_profiles
            columns:
              - column:
                  name: strategy_owner
                  type: varchar
                  constraints:
                    nullable: false
                    unique: true
                    uniqueConstraintName: ak_scraper_owned_strategies_scraper_owned_profiles
              - column:
                  name: strategy_name
                  type: varchar
                  constraints:
                    nullable: false
                    unique: true
                    uniqueConstraintName: ak_scraper_owned_strategies_scraper_owned_profiles
              - column:
                  name: profile_owner
                  type: varchar
                  constraints:
                    nullable: false
                    unique: true
                    uniqueConstraintName: ak_scraper_owned_strategies_scraper_owned_profiles
              - column:
                  name: profile_name
                  type: varchar
                  constraints:
                    nullable: false
                    unique: true
                    uniqueConstraintName: ak_scraper_owned_strategies_scraper_owned_profiles

        - addForeignKeyConstraint:
            baseTableName: scraper_owned_strategies_scraper_owned_profiles
            baseColumnNames: strategy_owner, strategy_name
            constraintName: fk_scraper_owned_strategies_scraper_owned_profiles_profiles
            referencedTableName: scraper_owned_strategies
            referencedColumnNames: owner, name

        - addForeignKeyConstraint:
            baseTableName: scraper_owned_strategies_scraper_owned_profiles
            baseColumnNames: profile_owner, profile_name
            constraintName: fk_scraper_owned_strategies_scraper_owned_profiles_strategies
            referencedTableName: scraper_owned_profiles
            referencedColumnNames: owner, name
